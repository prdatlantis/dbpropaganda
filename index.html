<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestionale Reale - Admin</title>
    <style>
        :root {
            --bg-dark: #0d0d0d;
            --card-bg: #1a1a1b;
            --primary: #28a745;
            --text: #e0e0e0;
            --accent: #444;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg-dark); color: var(--text); }

        /* LOGIN PAGE */
        #login-page {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle, #1a1a1b 0%, #000 100%);
        }

        .login-box {
            background: var(--card-bg);
            padding: 40px;
            border-radius: 12px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            text-align: center;
        }

        .form-group { text-align: left; margin-bottom: 20px; position: relative; }
        .form-group label { display: block; margin-bottom: 8px; color: #888; font-size: 14px; }
        .form-group input { 
            width: 100%; padding: 12px; border: 1px solid var(--accent); 
            border-radius: 6px; background: #2a2a2b; color: #fff; 
        }
        
        .toggle-pass {
            position: absolute; right: 12px; top: 38px;
            cursor: pointer; user-select: none;
        }

        .btn-login {
            width: 100%; padding: 12px; background: var(--primary);
            color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;
        }

        /* APP LAYOUT */
        #app { display: none; }
        .navbar {
            background: var(--card-bg);
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            border-bottom: 1px solid var(--accent);
        }

        .nav-links { display: flex; list-style: none; gap: 25px; }
        .nav-links li { cursor: pointer; font-weight: 500; color: #aaa; transition: 0.3s; }
        .nav-links li:hover, .nav-links li.active { color: var(--primary); }

        .container { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
        .section { display: none; }
        .section.active { display: block; }

        /* TABLES */
        table { width: 100%; border-collapse: collapse; background: var(--card-bg); border-radius: 8px; overflow: hidden; margin-top: 20px; }
        th { background: #2a2a2b; padding: 15px; text-align: left; font-size: 13px; color: #888; }
        td { padding: 15px; border-bottom: 1px solid #2a2a2b; font-size: 14px; }

        .badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; }
        .badge.neutro { background: #555; }
        .badge.verificato { background: #28a745; color: white; }
    </style>
</head>
<body>

    <div id="login-page">
        <div class="login-box">
            <h2 style="margin-bottom: 20px;">Accedi al Gestionale</h2>
            <form id="login-form">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="user" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="pass" required>
                    <span class="toggle-pass" onclick="togglePass()">üëÅÔ∏è</span>
                </div>
                <button type="submit" class="btn-login">ACCEDI</button>
            </form>
        </div>
    </div>

    <div id="app">
        <nav class="navbar">
            <ul class="nav-links">
                <li class="active" onclick="showSection('registro')">REGISTRO</li>
                <li onclick="showSection('dipendenti')">DIPENDENTI</li>
            </ul>
            <button onclick="location.reload()" style="background:none; border:none; color:#ff4444; cursor:pointer;">Esci</button>
        </nav>

        <div class="container">
            <section id="registro" class="section active">
                <h2>Tesseramenti dal Bot</h2>
                <table>
                    <thead>
                        <tr>
                            <th>DATA</th><th>PROPAGANDISTA</th><th>TESSERATO</th><th>LAVORO</th><th>TELEGRAM</th><th>STATO</th>
                        </tr>
                    </thead>
                    <tbody id="t-body-registro"></tbody>
                </table>
            </section>

            <section id="dipendenti" class="section">
                <h2>Elenco Personale</h2>
                <table>
                    <thead>
                        <tr>
                            <th>ID</th><th>NOME</th><th>RUOLO</th><th>DATA ASSUNZIONE</th>
                        </tr>
                    </thead>
                    <tbody id="t-body-dipendenti"></tbody>
                </table>
            </section>
        </div>
    </div>

    <script>
        const API_URL = "http://localhost:5000/api/all";

        // 1. Visibilit√† Password
        function togglePass() {
            const p = document.getElementById('pass');
            p.type = p.type === 'password' ? 'text' : 'password';
        }

        // 2. Login Reale
        document.getElementById('login-form').onsubmit = function(e) {
            e.preventDefault();
            const user = document.getElementById('user').value;
            const pass = document.getElementById('pass').value;

            if(user === "admin" && pass === "admin") { // Puoi cambiare le credenziali qui
                document.getElementById('login-page').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                loadAllData();
            } else {
                alert("Credenziali errate!");
            }
        };

        // 3. Navigazione Sezioni
        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-links li').forEach(l => l.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            // Aggiungi classe active al tasto cliccato
            event.currentTarget.classList.add('active');
        }

        // 4. Caricamento Dati dal Server Python
        async function loadAllData() {
            try {
                const response = await fetch(API_URL);
                const data = await response.json();

                // Popola Tesseramenti
                const tBodyReg = document.getElementById('t-body-registro');
                tBodyReg.innerHTML = data.tesseramenti.map(row => `
                    <tr>
                        <td>${row[1]}</td>
                        <td>${row[2]}</td>
                        <td>${row[3]}</td>
                        <td>${row[4]}</td>
                        <td>${row[5]}</td>
                        <td><span class="badge ${row[6].toLowerCase()}">${row[6]}</span></td>
                    </tr>
                `).join('');

                // Popola Dipendenti
                const tBodyDip = document.getElementById('t-body-dipendenti');
                tBodyDip.innerHTML = data.dipendenti.map(row => `
                    <tr>
                        <td>#${row[0]}</td>
                        <td>${row[1]}</td>
                        <td>${row[2]}</td>
                        <td>${row[3]}</td>
                    </tr>
                `).join('');

            } catch (error) {
                console.error("Errore nel caricamento dati:", error);
            }
        }

        // Aggiorna i dati ogni 10 secondi per vedere i nuovi tesseramenti del bot
        setInterval(() => {
            if(document.getElementById('app').style.display === 'block') {
                loadAllData();
            }
        }, 10000);

    </script>
</body>
</html>
